import funkin.play.character.MultiAnimateAtlasCharacter;
import funkin.play.character.CharacterType;
import funkin.play.PlayState;
import funkin.play.GameOverSubState;
import flixel.util.FlxTimer;
import funkin.graphics.FunkinSprite;
import funkin.audio.FunkinSound;
import flixel.FlxSprite;
import flixel.FlxG;
import funkin.modding.base.ScriptedFunkinSprite;
import flixel.group.FlxTypedSpriteGroup;
import flixel.effects.FlxFlicker;
import funkin.play.PauseSubState;
import funkin.modding.module.ModuleHandler;
import flixel.tweens.FlxTween;
import funkin.Preferences;
import funkin.util.Constants;

class PicoHoldingNeneCharacter extends MultiAnimateAtlasCharacter
{
  function new()
  {
    super('pico-holding-nene');
  }

  override function onCreate(event:ScriptEvent):Void
  {
    super.onCreate(event);

    // NOTE: this.x and this.y are not properly set here.

    GameOverSubState.musicSuffix = '-pico';
    GameOverSubState.blueBallSuffix = '-pico-and-nene';

    PauseSubState.musicSuffix = '-pico';

    this.animation.onFinish.add(onAnimationComplete);
  }

  override function onSongRetry(event:ScriptEvent):Void
  {
    super.onSongRetry(event);

    // Reset to standard death animation.
    GameOverSubState.musicSuffix = '-pico';
    GameOverSubState.blueBallSuffix = '-pico-and-nene';

    PauseSubState.musicSuffix = '-pico';
  }

  override function playAnimation(name:String, restart:Bool, ignoreOther:Bool)
  {
    if (name == "firstDeath")
    {
      new FlxTimer().start(0.58, afterPicoDeathNeneIntro);
    }

    super.playAnimation(name, restart, ignoreOther);
  }

  function afterPicoDeathNeneIntro():Void
  {
    // Delay the death quote because the first death animation is so fast.
    new FlxTimer().start(1.5, function(_) {
      // Prevent playing the death quote twice or if skipping the death animation.
      if (GameOverSubState.instance.hasPlayedDeathQuote) return;

      GameOverSubState.instance.playDeathQuote();
    });
  }

  function onAnimationComplete(animationName:String):Void
  {
    switch (animationName)
    {
      case "deathConfirm":
        this.playAnimation("deathConfirm-loop", true);
      case "laughEnd":
        this.playAnimation("laughEnd-loop", true);
    }
  }

  function getDeathQuote():Null<String>
  {
    var randomCensor:Array<Int> = [];

    if (!Preferences.naughtyness)
    {
      // 4 - fucking
      // 7 - goddamn, ass
      // 8 - fuck
      // 9 - ass, bitch
      randomCensor = [4, 7, 8, 9];
    }
    else if (Constants.CENSOR_EXPLETIVES)
    {
      randomCensor = [4, 8];
    }

    return Paths.sound('jeffGameover-pico/jeffGameover-' + FlxG.random.int(1, 10, randomCensor));
  }
}
